import l,{useCallback as D,useMemo as n}from"../../../__snowpack__/pkg/react.js";import Z,{DownloadDataTypes as A,chartSize as f,chartSizeInRem as P}from"../ScalarChart.js";import{XAxis as U,chartData as V,nearestPoint as O,singlePointRange as $,sortingMethodMap as tt,tooltip as at,xAxisMap as F}from"../../resource/scalar/index.js";import L from"../Chart.js";import{Chart as q}from"../Loader/ChartPage.js";import{XAxisType as u}from"../LineChart.js";import{cycleFetcher as et}from"../../utils/fetch.js";import M from"../../../__snowpack__/pkg/query-string.js";import rt from"../../utils/saveFile.js";import nt from"../../../__snowpack__/pkg/styled-components.js";import{useRunningRequest as ot}from"../../hooks/useRequest.js";import{useTranslation as st}from"../../../__snowpack__/pkg/react-i18next.js";import y from"../../hooks/useWebAssembly.js";const lt=nt.div`
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
`,ct=({runs:r,tag:c,smoothing:j,xAxis:o,sortingMethod:b,outlier:k,smoothedOnly:C,showMostValue:w,running:z})=>{const{t:I,i18n:E}=st(["scalar","common"]),{data:p,error:W,loading:X}=ot(r.map(t=>`/scalar/list?${M.stringify({run:t.label,tag:c})}`),!!z,(...t)=>et(t)),i=n(()=>{var t;return(t=p==null?void 0:p.filter(e=>e!=null).slice(0,r.length))!=null?t:[]},[p,r.length]),_=n(()=>o===U.WallTime?u.time:u.value,[o]),B=n(()=>{var t;return[(t=i.map(e=>{var d;return(d=e.map(m=>[m[0],m[1],Number.isFinite(m[2])?m[2]:null]))!=null?d:[]}))!=null?t:[],j]},[i,j]),{data:h}=y("scalar_transform",B),a=n(()=>h!=null?h:[],[h]),G=n(()=>[a,!!k],[a,k]),{data:R}=y("scalar_axis_range",G),H=n(()=>[a],[a]),{data:s}=y("scalar_range",H),S=n(()=>{let t,e=R;return a.length===1&&a[0].length===1&&([u.value,u.log].includes(_)&&(t=$(a[0][0][F[o]])),e=$(a[0][0][2])),{x:t,y:e}},[a,R,_,o]),v=n(()=>V({data:a,rawData:i,ranges:w?s!=null?s:[]:[],runs:r,xAxis:o,smoothedOnly:C}),[a,i,w,s,r,o,C]),x=n(()=>String(Math.max(...a.map(t=>Math.max(...t.map(e=>e[1]))))).length,[a]),J=D((t,e)=>{const d=F[o],m=O(a,i,r,d,e).map(g=>({...g,...s==null?void 0:s[r.findIndex(Y=>Y.label===g.run.label)]})),T=tt[b](m,e),{columns:N,data:Q}=at(T,x,E);return{runs:T.map(g=>g.run),columns:N,data:Q}},[o,a,i,r,b,x,E,s]),K=D(t=>{rt(r.map(e=>`/scalar/data?${M.stringify({run:e.label,tag:c,type:t})}`),r.map(e=>`visualdl-scalar-${e.label}-${c}.${A[t]}`),`visualdl-scalar-${c}.zip`)},[r,c]);return!v&&W?l.createElement(lt,null,I("common:error")):l.createElement(Z,{title:c,data:v,loading:X,xAxisType:_,xRange:S.x,yRange:S.y,getTooltipTableData:J,downloadData:K})};export default ct;export const Loader=()=>l.createElement(l.Fragment,null,l.createElement(L,{...P},l.createElement(q,{width:f.width-2,height:f.height-2})),l.createElement(L,{...P},l.createElement(q,{width:f.width-2,height:f.height-2})));
