<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1"/>
<meta name="generator" content="pdoc 0.10.0"/>
<title>sertit.ci API documentation</title>
<meta name="description" content="CI tools â€¦"/>
<link rel="preload stylesheet" as="style"
href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css"
integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style"
href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css"
integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style"
href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/darcula.min.css"
crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}#lunr-search{width:100%;font-size:1em;padding:6px 9px 5px 9px;border:1px solid silver}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100%;padding:3em 4em;border-left:1px solid #ddd;overflow-x:hidden}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}table{display:block;overflow-x:auto;word-break:keep-all;border-collapse:separate;border-spacing:0}th{background-color:#c4d5e780;padding:5px;border-bottom:0.1px solid gray;border-right:0.1px solid gray;border-top:0.1px solid gray}td,th{margin:0}td{white-space:nowrap;border-bottom:0.1px solid gray;border-right:0.1px solid gray}td:empty{background-color:#ececec}th:nth-child(1){border-left:0.1px solid gray}td:nth-child(1){border-left:0.1px solid gray;border-right:0.1px solid gray}th:nth-child(1),td:nth-child(1){background-color:#c4d5e7;position:-webkit-sticky;position:sticky;left:0}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML"
integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"
integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>sertit.ci</code></h1>
</header>
<section id="section-intro">
<p>CI tools</p>
<p>You can use <code><a title="sertit.ci.assert_raster_equal" href="#sertit.ci.assert_raster_equal">assert_raster_equal()</a></code> only if you have installed sertit[full] or sertit[rasters]</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python"># -*- coding: utf-8 -*-
# Copyright 2021, SERTIT-ICube - France, https://sertit.unistra.fr/
# This file is part of sertit-utils project
#     https://github.com/sertit/sertit-utils
#
# Licensed under the Apache License, Version 2.0 (the &#34;License&#34;);
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an &#34;AS IS&#34; BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
&#34;&#34;&#34;
CI tools

You can use `assert_raster_equal` only if you have installed sertit[full] or sertit[rasters]
&#34;&#34;&#34;
import filecmp
import os
from doctest import Example
from pathlib import Path
from typing import Union

import geopandas as gpd
import numpy as np
import rasterio
from cloudpathlib import AnyPath, CloudPath
from lxml import etree
from lxml.doctestcompare import LXMLOutputChecker

from sertit import vectors


def get_mnt_path() -&gt; str:
    &#34;&#34;&#34;
    Return mounting directory `/mnt`.

    .. WARNING::
        This won&#39;t work on Windows !

    ```python
    &gt;&gt;&gt; get_mnt_path()
    &#39;/mnt&#39;
    ```

    Returns:
        str: Mounting directory
    &#34;&#34;&#34;
    return r&#34;/mnt&#34;


def _get_db_path(db_nb=2) -&gt; str:
    &#34;&#34;&#34;
    Return mounted directory `/mnt/ds2_db2` which corresponds to `\\ds2\database02`.

    .. WARNING::
        Use it carefully (OK in CI) as this directory may not exist ! This won&#39;t work on Windows !

    ```python
    &gt;&gt;&gt; get_db_path(db_nb=2)
    &#39;/mnt/ds2_db2&#39;
    ```
    &#34;&#34;&#34;
    db_path = f&#34;{get_mnt_path()}/ds2_db{db_nb}&#34;

    if not os.path.isdir(db_path):
        raise NotADirectoryError(f&#34;Directory not found: {db_path}&#34;)

    return db_path


def get_db2_path() -&gt; str:
    &#34;&#34;&#34;
    Return mounted directory `/mnt/ds2_db2` which corresponds to `\\ds2\database02`.

    .. WARNING::
        Use it carefully (OK in CI) as this directory may not exist ! This won&#39;t work on Windows !

    ```python
    &gt;&gt;&gt; get_db2_path()
    &#39;/mnt/ds2_db2&#39;
    ```

    Returns:
        str: Mounted directory
    &#34;&#34;&#34;
    return _get_db_path(2)


def get_db3_path() -&gt; str:
    &#34;&#34;&#34;
    Return mounted directory `/mnt/ds2_db3` which corresponds to `\\ds2\database03`.

    .. WARNING::
        Use it carefully (OK in CI) as this directory may not exist ! This won&#39;t work on Windows !

    ```python
    &gt;&gt;&gt; get_db3_path()
    &#39;/mnt/ds2_db3&#39;
    ```

    Returns:
        str: Mounted directory
    &#34;&#34;&#34;
    return _get_db_path(3)


def get_db4_path() -&gt; str:
    &#34;&#34;&#34;
    Return mounted directory `/mnt/ds2_db4` which corresponds to `\\ds2\database04`.

    .. WARNING::
        Use it carefully (OK in CI) as this directory may not exist ! This won&#39;t work on Windows !

    ```python
    &gt;&gt;&gt; get_db4_path()
    &#39;/mnt/ds2_db4&#39;
    ```

    Returns:
        str: Mounted directory
    &#34;&#34;&#34;
    return _get_db_path(4)


def assert_raster_equal(
    path_1: Union[str, CloudPath, Path], path_2: Union[str, CloudPath, Path]
) -&gt; None:
    &#34;&#34;&#34;
    Assert that two rasters are equal.

    -&gt; Useful for pytests.

    ```python
    &gt;&gt;&gt; path = r&#34;CI\DATA\rasters\raster.tif&#34;
    &gt;&gt;&gt; assert_raster_equal(path, path)
    &gt;&gt;&gt; # Raises AssertionError if sth goes wrong
    ```

    Args:
        path_1 (Union[str, CloudPath, Path]): Raster 1
        path_2 (Union[str, CloudPath, Path]): Raster 2
    &#34;&#34;&#34;
    with rasterio.open(str(path_1)) as dst_1:
        with rasterio.open(str(path_2)) as dst_2:
            assert dst_1.meta == dst_2.meta
            np.testing.assert_array_equal(dst_1.read(), dst_2.read())


def assert_raster_almost_equal(
    path_1: Union[str, CloudPath, Path], path_2: Union[str, CloudPath, Path], decimal=7
) -&gt; None:
    &#34;&#34;&#34;
    Assert that two rasters are almost equal.
    (everything is equal except the transform and the arrays that are almost equal)

    Accepts an offset of `1E{decimal}` on the array and a precision of 10^-9 on the transform

    -&gt; Useful for pytests.

    ```python
    &gt;&gt;&gt; path = r&#34;CI\DATA\rasters\raster.tif&#34;
    &gt;&gt;&gt; path2 = r&#34;CI\DATA\rasters\raster_almost.tif&#34;
    &gt;&gt;&gt; assert_raster_equal(path, path2)
    &gt;&gt;&gt; # Raises AssertionError if sth goes wrong
    ```

    Args:
        path_1 (Union[str, CloudPath, Path]): Raster 1
        path_2 (Union[str, CloudPath, Path]): Raster 2
    &#34;&#34;&#34;

    with rasterio.open(str(path_1)) as dst_1:
        with rasterio.open(str(path_2)) as dst_2:
            assert dst_1.meta[&#34;driver&#34;] == dst_2.meta[&#34;driver&#34;]
            assert dst_1.meta[&#34;dtype&#34;] == dst_2.meta[&#34;dtype&#34;]
            assert dst_1.meta[&#34;nodata&#34;] == dst_2.meta[&#34;nodata&#34;]
            assert dst_1.meta[&#34;width&#34;] == dst_2.meta[&#34;width&#34;]
            assert dst_1.meta[&#34;height&#34;] == dst_2.meta[&#34;height&#34;]
            assert dst_1.meta[&#34;count&#34;] == dst_2.meta[&#34;count&#34;]
            assert dst_1.meta[&#34;crs&#34;] == dst_2.meta[&#34;crs&#34;]
            assert dst_1.meta[&#34;transform&#34;].almost_equals(
                dst_2.meta[&#34;transform&#34;], precision=1e-9
            )
            np.testing.assert_almost_equal(dst_1.read(), dst_2.read(), decimal=decimal)


def assert_raster_max_mismatch(
    path_1: Union[str, CloudPath, Path],
    path_2: Union[str, CloudPath, Path],
    max_mismatch_pct=0.5,
) -&gt; None:
    &#34;&#34;&#34;
    Assert that two rasters are almost equal.
    (everything is equal except the transform and the arrays that are almost equal)

    Accepts an offset of `1E{decimal}` on the array and a precision of 10^-9 on the transform

    -&gt; Useful for pytests.

    ```python
    &gt;&gt;&gt; path = r&#34;CI\DATA\rasters\raster.tif&#34;
    &gt;&gt;&gt; path2 = r&#34;CI\DATA\rasters\raster_almost.tif&#34;
    &gt;&gt;&gt; assert_raster_equal(path, path2)
    &gt;&gt;&gt; # Raises AssertionError if sth goes wrong
    ```

    Args:
        path_1 (Union[str, CloudPath, Path]): Raster 1
        path_2 (Union[str, CloudPath, Path]): Raster 2
        max_mismatch_pct (float): Maximum of element mismatch in %
    &#34;&#34;&#34;

    with rasterio.open(str(path_1)) as dst_1:
        with rasterio.open(str(path_2)) as dst_2:
            assert dst_1.meta[&#34;driver&#34;] == dst_2.meta[&#34;driver&#34;]
            assert dst_1.meta[&#34;dtype&#34;] == dst_2.meta[&#34;dtype&#34;]
            assert dst_1.meta[&#34;nodata&#34;] == dst_2.meta[&#34;nodata&#34;]
            assert dst_1.meta[&#34;width&#34;] == dst_2.meta[&#34;width&#34;]
            assert dst_1.meta[&#34;height&#34;] == dst_2.meta[&#34;height&#34;]
            assert dst_1.meta[&#34;count&#34;] == dst_2.meta[&#34;count&#34;]
            assert dst_1.meta[&#34;crs&#34;] == dst_2.meta[&#34;crs&#34;]
            assert dst_1.meta[&#34;transform&#34;].almost_equals(
                dst_2.meta[&#34;transform&#34;], precision=1e-9
            )
            nof_mismatch = np.count_nonzero(dst_1.read() != dst_2.read())
            assert (
                nof_mismatch / (dst_1.count * dst_1.width * dst_1.height)
            ) * 100.0 &lt; max_mismatch_pct


def assert_dir_equal(
    path_1: Union[str, CloudPath, Path], path_2: Union[str, CloudPath, Path]
) -&gt; None:
    &#34;&#34;&#34;
    Assert that two directories are equal.

    # Useful for pytests.

    ```python
    &gt;&gt;&gt; path = r&#34;CI\DATA\rasters&#34;
    &gt;&gt;&gt; assert_dir_equal(path, path)
    &gt;&gt;&gt; # Raises AssertionError if sth goes wrong
    ```

    Args:
        path_1 (str): Directory 1
        path_2 (str): Directory 2
    &#34;&#34;&#34;
    path_1 = AnyPath(path_1)
    path_2 = AnyPath(path_2)
    assert path_1.is_dir()
    assert path_2.is_dir()

    dcmp = filecmp.dircmp(path_1, path_2)
    try:
        assert dcmp.left_only == []
        assert dcmp.right_only == []
    except FileNotFoundError:
        assert [AnyPath(path).name for path in AnyPath(path_1).iterdir()] == [
            AnyPath(path).name for path in AnyPath(path_2).iterdir()
        ]

    # def assert_archive_equal(path_1: str, path_2: str) -&gt; None:


#     &#34;&#34;&#34;
#     Assert that two archives are equal, by creating hashes that should be equal
#
#     Args:
#         path_1 (str): Archive 1
#         path_2 (str): Archive 2
#     &#34;&#34;&#34;
#     filecmp.cmp(path_1, path_2)
#
#     file_1 = hashlib.sha256(open(path_1, &#39;rb&#39;).read()).digest()
#     file_2 = hashlib.sha256(open(path_2, &#39;rb&#39;).read()).digest()
#     assert file_1 == file_2


def assert_geom_equal(
    geom_1: Union[str, CloudPath, Path, gpd.GeoDataFrame],
    geom_2: Union[str, CloudPath, Path, gpd.GeoDataFrame],
) -&gt; None:
    &#34;&#34;&#34;
    Assert that two geometries are equal
    (do not check equality between geodataframe as they may differ on other fields).

    -&gt; Useful for pytests.

    ```python
    &gt;&gt;&gt; path = r&#34;CI\DATA\vectors\aoi.geojson&#34;
    &gt;&gt;&gt; assert_geom_equal(path, path)
    &gt;&gt;&gt; # Raises AssertionError if sth goes wrong
    ```

    .. WARNING::
        Only checks:
         - valid geometries
         - length of GeoDataFrame
         - CRS

    Args:
        geom_1 (gpd.GeoDataFrame): Geometry 1
        geom_2 (gpd.GeoDataFrame): Geometry 2
    &#34;&#34;&#34;
    if not isinstance(geom_1, (gpd.GeoDataFrame, gpd.GeoSeries)):
        geom_1 = vectors.read(geom_1)
    if not isinstance(geom_2, (gpd.GeoDataFrame, gpd.GeoSeries)):
        geom_2 = vectors.read(geom_2)

    assert len(geom_1) == len(geom_2)
    assert geom_1.crs == geom_2.crs
    for idx in range(len(geom_1)):
        if geom_1.geometry.iat[idx].is_valid and geom_2.geometry.iat[idx].is_valid:
            # If valid geometries, assert that the both are equal
            assert geom_1.geometry.iat[idx].equals(geom_2.geometry.iat[idx])


def assert_xml_equal(xml_elem_1: etree._Element, xml_elem_2: etree._Element) -&gt; None:
    &#34;&#34;&#34;
    Assert that 2 XML (as etree Elements) are equal.

    -&gt; Useful for pytests.

    Args:
        xml_elem_1 (etree._Element): 1st Element
        xml_elem_2 (etree._Element): 2nd Element
    &#34;&#34;&#34;
    str_1 = etree.tounicode(xml_elem_1)
    str_2 = etree.tounicode(xml_elem_2)
    checker = LXMLOutputChecker()
    if not checker.check_output(str_1, str_2, 0):
        message = checker.output_difference(Example(&#34;&#34;, str_1), str_2, 0)
        raise AssertionError(message)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="sertit.ci.get_mnt_path"><code class="name flex">
<p>def <span class="ident">get_mnt_path</span>(</p><p>)</p>
</code></dt>
<dd>
<div class="desc"><p>Return mounting directory <code>/mnt</code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This won't work on Windows !</p>
</div>
<pre><code class="language-python">&gt;&gt;&gt; get_mnt_path()
'/mnt'
</code></pre>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>Mounting directory</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_mnt_path() -&gt; str:
    &#34;&#34;&#34;
    Return mounting directory `/mnt`.

    .. WARNING::
        This won&#39;t work on Windows !

    ```python
    &gt;&gt;&gt; get_mnt_path()
    &#39;/mnt&#39;
    ```

    Returns:
        str: Mounting directory
    &#34;&#34;&#34;
    return r&#34;/mnt&#34;</code></pre>
</details>
</dd>
<dt id="sertit.ci.get_db2_path"><code class="name flex">
<p>def <span class="ident">get_db2_path</span>(</p><p>)</p>
</code></dt>
<dd>
<div class="desc"><p>Return mounted directory <code>/mnt/ds2_db2</code> which corresponds to <code>\ds2\database02</code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Use it carefully (OK in CI) as this directory may not exist ! This won't work on Windows !</p>
</div>
<pre><code class="language-python">&gt;&gt;&gt; get_db2_path()
'/mnt/ds2_db2'
</code></pre>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>Mounted directory</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_db2_path() -&gt; str:
    &#34;&#34;&#34;
    Return mounted directory `/mnt/ds2_db2` which corresponds to `\\ds2\database02`.

    .. WARNING::
        Use it carefully (OK in CI) as this directory may not exist ! This won&#39;t work on Windows !

    ```python
    &gt;&gt;&gt; get_db2_path()
    &#39;/mnt/ds2_db2&#39;
    ```

    Returns:
        str: Mounted directory
    &#34;&#34;&#34;
    return _get_db_path(2)</code></pre>
</details>
</dd>
<dt id="sertit.ci.get_db3_path"><code class="name flex">
<p>def <span class="ident">get_db3_path</span>(</p><p>)</p>
</code></dt>
<dd>
<div class="desc"><p>Return mounted directory <code>/mnt/ds2_db3</code> which corresponds to <code>\ds2\database03</code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Use it carefully (OK in CI) as this directory may not exist ! This won't work on Windows !</p>
</div>
<pre><code class="language-python">&gt;&gt;&gt; get_db3_path()
'/mnt/ds2_db3'
</code></pre>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>Mounted directory</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_db3_path() -&gt; str:
    &#34;&#34;&#34;
    Return mounted directory `/mnt/ds2_db3` which corresponds to `\\ds2\database03`.

    .. WARNING::
        Use it carefully (OK in CI) as this directory may not exist ! This won&#39;t work on Windows !

    ```python
    &gt;&gt;&gt; get_db3_path()
    &#39;/mnt/ds2_db3&#39;
    ```

    Returns:
        str: Mounted directory
    &#34;&#34;&#34;
    return _get_db_path(3)</code></pre>
</details>
</dd>
<dt id="sertit.ci.get_db4_path"><code class="name flex">
<p>def <span class="ident">get_db4_path</span>(</p><p>)</p>
</code></dt>
<dd>
<div class="desc"><p>Return mounted directory <code>/mnt/ds2_db4</code> which corresponds to <code>\ds2\database04</code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Use it carefully (OK in CI) as this directory may not exist ! This won't work on Windows !</p>
</div>
<pre><code class="language-python">&gt;&gt;&gt; get_db4_path()
'/mnt/ds2_db4'
</code></pre>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>str</code></dt>
<dd>Mounted directory</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_db4_path() -&gt; str:
    &#34;&#34;&#34;
    Return mounted directory `/mnt/ds2_db4` which corresponds to `\\ds2\database04`.

    .. WARNING::
        Use it carefully (OK in CI) as this directory may not exist ! This won&#39;t work on Windows !

    ```python
    &gt;&gt;&gt; get_db4_path()
    &#39;/mnt/ds2_db4&#39;
    ```

    Returns:
        str: Mounted directory
    &#34;&#34;&#34;
    return _get_db_path(4)</code></pre>
</details>
</dd>
<dt id="sertit.ci.assert_raster_equal"><code class="name flex">
<p>def <span class="ident">assert_raster_equal</span>(</p><p>path_1, <br>path_2)</p>
</code></dt>
<dd>
<div class="desc"><p>Assert that two rasters are equal.</p>
<p>-&gt; Useful for pytests.</p>
<pre><code class="language-python">&gt;&gt;&gt; path = r&quot;CI\DATA
asters
aster.tif&quot;
&gt;&gt;&gt; assert_raster_equal(path, path)
&gt;&gt;&gt; # Raises AssertionError if sth goes wrong
</code></pre>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>path_1</code></strong> :&ensp;<code>Union[str, CloudPath, Path]</code></dt>
<dd>Raster 1</dd>
<dt><strong><code>path_2</code></strong> :&ensp;<code>Union[str, CloudPath, Path]</code></dt>
<dd>Raster 2</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def assert_raster_equal(
    path_1: Union[str, CloudPath, Path], path_2: Union[str, CloudPath, Path]
) -&gt; None:
    &#34;&#34;&#34;
    Assert that two rasters are equal.

    -&gt; Useful for pytests.

    ```python
    &gt;&gt;&gt; path = r&#34;CI\DATA\rasters\raster.tif&#34;
    &gt;&gt;&gt; assert_raster_equal(path, path)
    &gt;&gt;&gt; # Raises AssertionError if sth goes wrong
    ```

    Args:
        path_1 (Union[str, CloudPath, Path]): Raster 1
        path_2 (Union[str, CloudPath, Path]): Raster 2
    &#34;&#34;&#34;
    with rasterio.open(str(path_1)) as dst_1:
        with rasterio.open(str(path_2)) as dst_2:
            assert dst_1.meta == dst_2.meta
            np.testing.assert_array_equal(dst_1.read(), dst_2.read())</code></pre>
</details>
</dd>
<dt id="sertit.ci.assert_raster_almost_equal"><code class="name flex">
<p>def <span class="ident">assert_raster_almost_equal</span>(</p><p>path_1, <br>path_2, <br>decimal=7)</p>
</code></dt>
<dd>
<div class="desc"><p>Assert that two rasters are almost equal.
(everything is equal except the transform and the arrays that are almost equal)</p>
<p>Accepts an offset of <code>1E{decimal}</code> on the array and a precision of 10^-9 on the transform</p>
<p>-&gt; Useful for pytests.</p>
<pre><code class="language-python">&gt;&gt;&gt; path = r&quot;CI\DATA
asters
aster.tif&quot;
&gt;&gt;&gt; path2 = r&quot;CI\DATA
asters
aster_almost.tif&quot;
&gt;&gt;&gt; assert_raster_equal(path, path2)
&gt;&gt;&gt; # Raises AssertionError if sth goes wrong
</code></pre>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>path_1</code></strong> :&ensp;<code>Union[str, CloudPath, Path]</code></dt>
<dd>Raster 1</dd>
<dt><strong><code>path_2</code></strong> :&ensp;<code>Union[str, CloudPath, Path]</code></dt>
<dd>Raster 2</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def assert_raster_almost_equal(
    path_1: Union[str, CloudPath, Path], path_2: Union[str, CloudPath, Path], decimal=7
) -&gt; None:
    &#34;&#34;&#34;
    Assert that two rasters are almost equal.
    (everything is equal except the transform and the arrays that are almost equal)

    Accepts an offset of `1E{decimal}` on the array and a precision of 10^-9 on the transform

    -&gt; Useful for pytests.

    ```python
    &gt;&gt;&gt; path = r&#34;CI\DATA\rasters\raster.tif&#34;
    &gt;&gt;&gt; path2 = r&#34;CI\DATA\rasters\raster_almost.tif&#34;
    &gt;&gt;&gt; assert_raster_equal(path, path2)
    &gt;&gt;&gt; # Raises AssertionError if sth goes wrong
    ```

    Args:
        path_1 (Union[str, CloudPath, Path]): Raster 1
        path_2 (Union[str, CloudPath, Path]): Raster 2
    &#34;&#34;&#34;

    with rasterio.open(str(path_1)) as dst_1:
        with rasterio.open(str(path_2)) as dst_2:
            assert dst_1.meta[&#34;driver&#34;] == dst_2.meta[&#34;driver&#34;]
            assert dst_1.meta[&#34;dtype&#34;] == dst_2.meta[&#34;dtype&#34;]
            assert dst_1.meta[&#34;nodata&#34;] == dst_2.meta[&#34;nodata&#34;]
            assert dst_1.meta[&#34;width&#34;] == dst_2.meta[&#34;width&#34;]
            assert dst_1.meta[&#34;height&#34;] == dst_2.meta[&#34;height&#34;]
            assert dst_1.meta[&#34;count&#34;] == dst_2.meta[&#34;count&#34;]
            assert dst_1.meta[&#34;crs&#34;] == dst_2.meta[&#34;crs&#34;]
            assert dst_1.meta[&#34;transform&#34;].almost_equals(
                dst_2.meta[&#34;transform&#34;], precision=1e-9
            )
            np.testing.assert_almost_equal(dst_1.read(), dst_2.read(), decimal=decimal)</code></pre>
</details>
</dd>
<dt id="sertit.ci.assert_raster_max_mismatch"><code class="name flex">
<p>def <span class="ident">assert_raster_max_mismatch</span>(</p><p>path_1, <br>path_2, <br>max_mismatch_pct=0.5)</p>
</code></dt>
<dd>
<div class="desc"><p>Assert that two rasters are almost equal.
(everything is equal except the transform and the arrays that are almost equal)</p>
<p>Accepts an offset of <code>1E{decimal}</code> on the array and a precision of 10^-9 on the transform</p>
<p>-&gt; Useful for pytests.</p>
<pre><code class="language-python">&gt;&gt;&gt; path = r&quot;CI\DATA
asters
aster.tif&quot;
&gt;&gt;&gt; path2 = r&quot;CI\DATA
asters
aster_almost.tif&quot;
&gt;&gt;&gt; assert_raster_equal(path, path2)
&gt;&gt;&gt; # Raises AssertionError if sth goes wrong
</code></pre>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>path_1</code></strong> :&ensp;<code>Union[str, CloudPath, Path]</code></dt>
<dd>Raster 1</dd>
<dt><strong><code>path_2</code></strong> :&ensp;<code>Union[str, CloudPath, Path]</code></dt>
<dd>Raster 2</dd>
<dt><strong><code>max_mismatch_pct</code></strong> :&ensp;<code>float</code></dt>
<dd>Maximum of element mismatch in %</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def assert_raster_max_mismatch(
    path_1: Union[str, CloudPath, Path],
    path_2: Union[str, CloudPath, Path],
    max_mismatch_pct=0.5,
) -&gt; None:
    &#34;&#34;&#34;
    Assert that two rasters are almost equal.
    (everything is equal except the transform and the arrays that are almost equal)

    Accepts an offset of `1E{decimal}` on the array and a precision of 10^-9 on the transform

    -&gt; Useful for pytests.

    ```python
    &gt;&gt;&gt; path = r&#34;CI\DATA\rasters\raster.tif&#34;
    &gt;&gt;&gt; path2 = r&#34;CI\DATA\rasters\raster_almost.tif&#34;
    &gt;&gt;&gt; assert_raster_equal(path, path2)
    &gt;&gt;&gt; # Raises AssertionError if sth goes wrong
    ```

    Args:
        path_1 (Union[str, CloudPath, Path]): Raster 1
        path_2 (Union[str, CloudPath, Path]): Raster 2
        max_mismatch_pct (float): Maximum of element mismatch in %
    &#34;&#34;&#34;

    with rasterio.open(str(path_1)) as dst_1:
        with rasterio.open(str(path_2)) as dst_2:
            assert dst_1.meta[&#34;driver&#34;] == dst_2.meta[&#34;driver&#34;]
            assert dst_1.meta[&#34;dtype&#34;] == dst_2.meta[&#34;dtype&#34;]
            assert dst_1.meta[&#34;nodata&#34;] == dst_2.meta[&#34;nodata&#34;]
            assert dst_1.meta[&#34;width&#34;] == dst_2.meta[&#34;width&#34;]
            assert dst_1.meta[&#34;height&#34;] == dst_2.meta[&#34;height&#34;]
            assert dst_1.meta[&#34;count&#34;] == dst_2.meta[&#34;count&#34;]
            assert dst_1.meta[&#34;crs&#34;] == dst_2.meta[&#34;crs&#34;]
            assert dst_1.meta[&#34;transform&#34;].almost_equals(
                dst_2.meta[&#34;transform&#34;], precision=1e-9
            )
            nof_mismatch = np.count_nonzero(dst_1.read() != dst_2.read())
            assert (
                nof_mismatch / (dst_1.count * dst_1.width * dst_1.height)
            ) * 100.0 &lt; max_mismatch_pct</code></pre>
</details>
</dd>
<dt id="sertit.ci.assert_dir_equal"><code class="name flex">
<p>def <span class="ident">assert_dir_equal</span>(</p><p>path_1, <br>path_2)</p>
</code></dt>
<dd>
<div class="desc"><p>Assert that two directories are equal.</p>
<h1 id="useful-for-pytests">Useful for pytests.</h1>
<pre><code class="language-python">&gt;&gt;&gt; path = r&quot;CI\DATA
asters&quot;
&gt;&gt;&gt; assert_dir_equal(path, path)
&gt;&gt;&gt; # Raises AssertionError if sth goes wrong
</code></pre>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>path_1</code></strong> :&ensp;<code>str</code></dt>
<dd>Directory 1</dd>
<dt><strong><code>path_2</code></strong> :&ensp;<code>str</code></dt>
<dd>Directory 2</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def assert_dir_equal(
    path_1: Union[str, CloudPath, Path], path_2: Union[str, CloudPath, Path]
) -&gt; None:
    &#34;&#34;&#34;
    Assert that two directories are equal.

    # Useful for pytests.

    ```python
    &gt;&gt;&gt; path = r&#34;CI\DATA\rasters&#34;
    &gt;&gt;&gt; assert_dir_equal(path, path)
    &gt;&gt;&gt; # Raises AssertionError if sth goes wrong
    ```

    Args:
        path_1 (str): Directory 1
        path_2 (str): Directory 2
    &#34;&#34;&#34;
    path_1 = AnyPath(path_1)
    path_2 = AnyPath(path_2)
    assert path_1.is_dir()
    assert path_2.is_dir()

    dcmp = filecmp.dircmp(path_1, path_2)
    try:
        assert dcmp.left_only == []
        assert dcmp.right_only == []
    except FileNotFoundError:
        assert [AnyPath(path).name for path in AnyPath(path_1).iterdir()] == [
            AnyPath(path).name for path in AnyPath(path_2).iterdir()
        ]</code></pre>
</details>
</dd>
<dt id="sertit.ci.assert_geom_equal"><code class="name flex">
<p>def <span class="ident">assert_geom_equal</span>(</p><p>geom_1, <br>geom_2)</p>
</code></dt>
<dd>
<div class="desc"><p>Assert that two geometries are equal
(do not check equality between geodataframe as they may differ on other fields).</p>
<p>-&gt; Useful for pytests.</p>
<pre><code class="language-python">&gt;&gt;&gt; path = r&quot;CI\DATAectorsoi.geojson&quot;
&gt;&gt;&gt; assert_geom_equal(path, path)
&gt;&gt;&gt; # Raises AssertionError if sth goes wrong
</code></pre>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Only checks:
- valid geometries
- length of GeoDataFrame
- CRS</p>
</div>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>geom_1</code></strong> :&ensp;<code>gpd.GeoDataFrame</code></dt>
<dd>Geometry 1</dd>
<dt><strong><code>geom_2</code></strong> :&ensp;<code>gpd.GeoDataFrame</code></dt>
<dd>Geometry 2</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def assert_geom_equal(
    geom_1: Union[str, CloudPath, Path, gpd.GeoDataFrame],
    geom_2: Union[str, CloudPath, Path, gpd.GeoDataFrame],
) -&gt; None:
    &#34;&#34;&#34;
    Assert that two geometries are equal
    (do not check equality between geodataframe as they may differ on other fields).

    -&gt; Useful for pytests.

    ```python
    &gt;&gt;&gt; path = r&#34;CI\DATA\vectors\aoi.geojson&#34;
    &gt;&gt;&gt; assert_geom_equal(path, path)
    &gt;&gt;&gt; # Raises AssertionError if sth goes wrong
    ```

    .. WARNING::
        Only checks:
         - valid geometries
         - length of GeoDataFrame
         - CRS

    Args:
        geom_1 (gpd.GeoDataFrame): Geometry 1
        geom_2 (gpd.GeoDataFrame): Geometry 2
    &#34;&#34;&#34;
    if not isinstance(geom_1, (gpd.GeoDataFrame, gpd.GeoSeries)):
        geom_1 = vectors.read(geom_1)
    if not isinstance(geom_2, (gpd.GeoDataFrame, gpd.GeoSeries)):
        geom_2 = vectors.read(geom_2)

    assert len(geom_1) == len(geom_2)
    assert geom_1.crs == geom_2.crs
    for idx in range(len(geom_1)):
        if geom_1.geometry.iat[idx].is_valid and geom_2.geometry.iat[idx].is_valid:
            # If valid geometries, assert that the both are equal
            assert geom_1.geometry.iat[idx].equals(geom_2.geometry.iat[idx])</code></pre>
</details>
</dd>
<dt id="sertit.ci.assert_xml_equal"><code class="name flex">
<p>def <span class="ident">assert_xml_equal</span>(</p><p>xml_elem_1, <br>xml_elem_2)</p>
</code></dt>
<dd>
<div class="desc"><p>Assert that 2 XML (as etree Elements) are equal.</p>
<p>-&gt; Useful for pytests.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>xml_elem_1</code></strong> :&ensp;<code>etree._Element</code></dt>
<dd>1st Element</dd>
<dt><strong><code>xml_elem_2</code></strong> :&ensp;<code>etree._Element</code></dt>
<dd>2nd Element</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def assert_xml_equal(xml_elem_1: etree._Element, xml_elem_2: etree._Element) -&gt; None:
    &#34;&#34;&#34;
    Assert that 2 XML (as etree Elements) are equal.

    -&gt; Useful for pytests.

    Args:
        xml_elem_1 (etree._Element): 1st Element
        xml_elem_2 (etree._Element): 2nd Element
    &#34;&#34;&#34;
    str_1 = etree.tounicode(xml_elem_1)
    str_2 = etree.tounicode(xml_elem_2)
    checker = LXMLOutputChecker()
    if not checker.check_output(str_1, str_2, 0):
        message = checker.output_difference(Example(&#34;&#34;, str_1), str_2, 0)
        raise AssertionError(message)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<header>
<a class="homelink" rel="home" title="Home" href="/sertit-utils/">
<img src="https://sertit.pages.sertit.unistra.fr/sertit-utils/sertit_utils.png"
alt="logo"
style="width:40%;"/>
</a>
</header>
<form>
<input id="lunr-search" name="q" placeholder="ðŸ”Ž Search ..." aria-label="Search"
disabled minlength="2">
</form>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.css" integrity="sha512-j1u8eUJ4f23xPPxwOrLUPQaCD2dwzNqqmDDcWS4deWsMv2ohLqmXXuP3hU7g8TyzbMSakP/mMqoNBYWj8AEIFg==" crossorigin>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.js" integrity="sha512-plGUER9JkeEWPPqQBE4sdLqBoQug5Ap+BCGMc7bJ8BXkm+VVj6QzkpBz5Yv2yPkkq+cqg9IpkBaGCas6uDbW8g==" crossorigin></script>
<style>
.modal-dialog iframe {
width: 100vw;
height: calc(100vh - 80px);
}
@media screen and (min-width: 700px) {
.modal-dialog iframe {
width: 70vw;
height: 80vh;
}
}
.modal-dialog .tingle-modal-box {width: auto;}
.modal-dialog .tingle-modal-box__content {padding: 0;}
</style>
<script>
const input = document.getElementById('lunr-search');
input.disabled = false;
input.form.addEventListener('submit', (ev) => {
ev.preventDefault();
const url = new URL(window.location);
url.searchParams.set('q', input.value);
history.replaceState({}, null, url.toString());
search(input.value);
});
const query = new URL(window.location).searchParams.get('q');
if (query)
search(query);
function search(query) {
const url = '../doc-search.html#' + encodeURIComponent(query);
new tingle.modal({
cssClass: ['modal-dialog'],
onClose: () => {
const url = new URL(window.location);
url.searchParams.delete('q');
history.replaceState({}, null, url.toString());
setTimeout(() => input.focus(), 100);
}
}).setContent('<iframe src="' + url + '"></iframe>').open();
}
</script>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="sertit" href="index.html">sertit</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="sertit.ci.get_mnt_path" href="#sertit.ci.get_mnt_path">get_mnt_path</a></code></li>
<li><code><a title="sertit.ci.get_db2_path" href="#sertit.ci.get_db2_path">get_db2_path</a></code></li>
<li><code><a title="sertit.ci.get_db3_path" href="#sertit.ci.get_db3_path">get_db3_path</a></code></li>
<li><code><a title="sertit.ci.get_db4_path" href="#sertit.ci.get_db4_path">get_db4_path</a></code></li>
<li><code><a title="sertit.ci.assert_raster_equal" href="#sertit.ci.assert_raster_equal">assert_raster_equal</a></code></li>
<li><code><a title="sertit.ci.assert_raster_almost_equal" href="#sertit.ci.assert_raster_almost_equal">assert_raster_almost_equal</a></code></li>
<li><code><a title="sertit.ci.assert_raster_max_mismatch" href="#sertit.ci.assert_raster_max_mismatch">assert_raster_max_mismatch</a></code></li>
<li><code><a title="sertit.ci.assert_dir_equal" href="#sertit.ci.assert_dir_equal">assert_dir_equal</a></code></li>
<li><code><a title="sertit.ci.assert_geom_equal" href="#sertit.ci.assert_geom_equal">assert_geom_equal</a></code></li>
<li><code><a title="sertit.ci.assert_xml_equal" href="#sertit.ci.assert_xml_equal">assert_xml_equal</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>