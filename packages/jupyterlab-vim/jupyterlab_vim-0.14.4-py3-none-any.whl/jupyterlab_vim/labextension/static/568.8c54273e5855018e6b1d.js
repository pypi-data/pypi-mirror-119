(self.webpackChunk_axlair_jupyterlab_vim=self.webpackChunk_axlair_jupyterlab_vim||[]).push([[568],{568:(e,o,t)=>{"use strict";t.r(o),t.d(o,{default:()=>k});var n=t(469),d=t(403),l=t(652),c=t(608);const i=!!navigator.platform.match(/Mac/i),a="@axlair/jupyterlab_vim";let s=!1;const r={id:a,autoStart:!0,activate:function(e,o,t,d){let l=!1;function i(d){s=!0===d.get("enabled").composite,s&&!l&&(l=!0,async function(e,o,t){await e.restored;const{commands:d,shell:l}=e;await t.ensureVimKeymap();const i=t.CodeMirror;function a(e){const t=o.currentWidget;return!1!==e.activate&&t&&l.activateById(t.id),t}function r(){return s&&null!==o.currentWidget&&o.currentWidget===e.shell.currentWidget}d.addCommand("run-select-next-edit",{label:"Run Cell and Edit Next Cell",execute:e=>{const o=a(e);if(o){const{context:e,content:t}=o;n.NotebookActions.runAndAdvance(t,e.sessionContext),o.content.mode="edit"}},isEnabled:r}),d.addCommand("run-cell-and-edit",{label:"Run Cell and Edit Cell",execute:e=>{const o=a(e);if(o){const{context:e,content:t}=o;n.NotebookActions.run(t,e.sessionContext),o.content.mode="edit"}},isEnabled:r}),d.addCommand("cut-cell-and-edit",{label:"Cut Cell(s) and Edit Cell",execute:e=>{const o=a(e);if(o){const{content:e}=o;n.NotebookActions.cut(e),e.mode="edit"}},isEnabled:r}),d.addCommand("copy-cell-and-edit",{label:"Copy Cell(s) and Edit Cell",execute:e=>{const o=a(e);if(o){const{content:e}=o;n.NotebookActions.copy(e),e.mode="edit"}},isEnabled:r}),d.addCommand("paste-cell-and-edit",{label:"Paste Cell(s) and Edit Cell",execute:e=>{const o=a(e);if(o){const{content:e}=o;n.NotebookActions.paste(e,"below"),e.mode="edit"}},isEnabled:r}),d.addCommand("merge-and-edit",{label:"Merge and Edit Cell",execute:e=>{const o=a(e);if(o){const{content:e}=o;n.NotebookActions.mergeCells(e),o.content.mode="edit"}},isEnabled:r}),d.addCommand("enter-insert-mode",{label:"Enter Insert Mode",execute:e=>{const o=a(e);if(o){const{content:e}=o;if(null!==e.activeCell){const t=e.activeCell.editor;o.content.mode="edit",i.Vim.handleKey(t.editor,"i")}}},isEnabled:r}),d.addCommand("leave-insert-mode",{label:"Leave Insert Mode",execute:e=>{const o=a(e);if(o){const{content:e}=o;if(null!==e.activeCell){const o=e.activeCell.editor;i.Vim.handleKey(o.editor,"<Esc>")}}},isEnabled:r}),d.addCommand("select-below-execute-markdown",{label:"Execute Markdown and Select Cell Below",execute:e=>{const o=a(e);if(o){const{content:e}=o;return null!==e.activeCell&&"markdown"===e.activeCell.model.type&&(o.content.activeCell.rendered=!0),n.NotebookActions.selectBelow(o.content)}},isEnabled:r}),d.addCommand("select-above-execute-markdown",{label:"Execute Markdown and Select Cell Below",execute:e=>{const o=a(e);if(o){const{content:e}=o;return null!==e.activeCell&&"markdown"===e.activeCell.model.type&&(o.content.activeCell.rendered=!0),n.NotebookActions.selectAbove(o.content)}},isEnabled:r}),d.addCommand("select-first-cell",{label:"Select First Cell",execute:e=>{const o=a(e);if(o){const{content:e}=o;e.activeCellIndex=0,e.deselectAll(),null!==e.activeCell&&c.ElementExt.scrollIntoViewIfNeeded(e.node,e.activeCell.node)}},isEnabled:r}),d.addCommand("select-last-cell",{label:"Select Last Cell",execute:e=>{const o=a(e);if(o){const{content:e}=o;e.activeCellIndex=o.content.widgets.length-1,e.deselectAll(),null!==e.activeCell&&c.ElementExt.scrollIntoViewIfNeeded(e.node,e.activeCell.node)}},isEnabled:r}),d.addCommand("center-cell",{label:"Center Cell",execute:e=>{const o=a(e);if(o&&null!==o.content.activeCell){const e=o.content.activeCell.inputArea.node.getBoundingClientRect();o.content.scrollToPosition(e.bottom,0)}},isEnabled:r}),d.addKeyBinding({selector:".jp-Notebook.jp-mod-editMode",keys:["Ctrl O","U"],command:"notebook:undo-cell-action"}),d.addKeyBinding({selector:".jp-Notebook.jp-mod-editMode",keys:["Ctrl O","-"],command:"notebook:split-cell-at-cursor"}),d.addKeyBinding({selector:".jp-Notebook.jp-mod-editMode",keys:["Ctrl O","D"],command:"cut-cell-and-edit"}),d.addKeyBinding({selector:".jp-Notebook.jp-mod-editMode",keys:["Ctrl O","Y"],command:"copy-cell-and-edit"}),d.addKeyBinding({selector:".jp-Notebook.jp-mod-editMode",keys:["Ctrl O","P"],command:"paste-cell-and-edit"}),d.addKeyBinding({selector:".jp-Notebook.jp-mod-editMode",keys:["Ctrl Shift J"],command:"notebook:extend-marked-cells-below"}),d.addKeyBinding({selector:".jp-Notebook:focus",keys:["Ctrl Shift J"],command:"notebook:extend-marked-cells-below"}),d.addKeyBinding({selector:".jp-Notebook.jp-mod-editMode",keys:["Ctrl Shift K"],command:"notebook:extend-marked-cells-above"}),d.addKeyBinding({selector:".jp-Notebook:focus",keys:["Ctrl Shift K"],command:"notebook:extend-marked-cells-above"}),d.addKeyBinding({selector:".jp-Notebook.jp-mod-editMode",keys:["Ctrl O","Shift O"],command:"notebook:insert-cell-above"}),d.addKeyBinding({selector:".jp-Notebook.jp-mod-editMode",keys:["Ctrl O","Ctrl O"],command:"notebook:insert-cell-above"}),d.addKeyBinding({selector:".jp-Notebook.jp-mod-editMode",keys:["Ctrl O","O"],command:"notebook:insert-cell-below"}),d.addKeyBinding({selector:".jp-Notebook.jp-mod-editMode",keys:["Ctrl J"],command:"select-below-execute-markdown"}),d.addKeyBinding({selector:".jp-Notebook.jp-mod-editMode",keys:["Ctrl K"],command:"select-above-execute-markdown"}),d.addKeyBinding({selector:".jp-Notebook.jp-mod-editMode",keys:["Escape"],command:"leave-insert-mode"}),d.addKeyBinding({selector:".jp-Notebook.jp-mod-editMode",keys:["Ctrl ["],command:"leave-insert-mode"}),d.addKeyBinding({selector:".jp-Notebook:focus",keys:["Ctrl I"],command:"enter-insert-mode"}),d.addKeyBinding({selector:".jp-Notebook.jp-mod-editMode",keys:["Ctrl Enter"],command:"run-cell-and-edit"}),d.addKeyBinding({selector:".jp-Notebook.jp-mod-editMode",keys:["Shift Enter"],command:"run-select-next-edit"}),d.addKeyBinding({selector:".jp-Notebook.jp-mod-editMode",keys:["Shift Escape"],command:"notebook:enter-command-mode"}),d.addKeyBinding({selector:".jp-Notebook:focus",keys:["Shift M"],command:"merge-and-edit"}),d.addKeyBinding({selector:".jp-Notebook.jp-mod-editMode",keys:["Accel 1"],command:"notebook:change-cell-to-code"}),d.addKeyBinding({selector:".jp-Notebook.jp-mod-editMode",keys:["Accel 2"],command:"notebook:change-cell-to-markdown"}),d.addKeyBinding({selector:".jp-Notebook.jp-mod-editMode",keys:["Accel 3"],command:"notebook:change-cell-to-raw"}),d.addKeyBinding({selector:".jp-Notebook.jp-mod-editMode",keys:["Ctrl O","G"],command:"select-first-cell"}),d.addKeyBinding({selector:".jp-Notebook.jp-mod-editMode",keys:["Ctrl O","Ctrl G"],command:"select-last-cell"}),d.addKeyBinding({selector:".jp-Notebook:focus",keys:["G","G"],command:"select-first-cell"}),d.addKeyBinding({selector:".jp-Notebook:focus",keys:["Shift G"],command:"select-last-cell"}),d.addKeyBinding({selector:".jp-Notebook:focus",keys:["Y","Y"],command:"notebook:copy-cell"}),d.addKeyBinding({selector:".jp-Notebook:focus",keys:["D","D"],command:"notebook:cut-cell"}),d.addKeyBinding({selector:".jp-Notebook:focus",keys:["Shift P"],command:"notebook:paste-cell-above"}),d.addKeyBinding({selector:".jp-Notebook:focus",keys:["P"],command:"notebook:paste-cell-below"}),d.addKeyBinding({selector:".jp-Notebook:focus",keys:["O"],command:"notebook:insert-cell-below"}),d.addKeyBinding({selector:".jp-Notebook:focus",keys:["Shift O"],command:"notebook:insert-cell-above"}),d.addKeyBinding({selector:".jp-Notebook:focus",keys:["U"],command:"notebook:undo-cell-action"}),d.addKeyBinding({selector:".jp-Notebook:focus",keys:["Ctrl E"],command:"notebook:move-cell-down"}),d.addKeyBinding({selector:".jp-Notebook:focus",keys:["Ctrl Y"],command:"notebook:move-cell-up"}),d.addKeyBinding({selector:".jp-Notebook:focus",keys:["Z","Z"],command:"center-cell"}),d.addKeyBinding({selector:".jp-Notebook:focus",keys:["Z","C"],command:"notebook:hide-cell-code"}),d.addKeyBinding({selector:".jp-Notebook:focus",keys:["Z","O"],command:"notebook:show-cell-code"}),d.addKeyBinding({selector:".jp-Notebook:focus",keys:["Z","M"],command:"notebook:hide-all-cell-code"}),d.addKeyBinding({selector:".jp-Notebook:focus",keys:["Z","R"],command:"notebook:show-all-cell-code"}),d.addKeyBinding({selector:".jp-Notebook.jp-mod-editMode",keys:["Ctrl O","Z","Z"],command:"center-cell"}),d.addKeyBinding({selector:".jp-Notebook.jp-mod-editMode .jp-InputArea-editor:not(.jp-mod-has-primary-selection)",keys:["Ctrl G"],command:"tooltip:launch-notebook"}),new m(e,o,i)}(e,o,t))}return d.load(`${a}:plugin`).then((e=>{i(e),e.changed.connect(i)}),(e=>{console.error(`Could not load settings, so did not active ${a}: ${e}`)})),Promise.resolve()},requires:[n.INotebookTracker,d.ICodeMirror,l.ISettingRegistry]};class m{constructor(e,o,t){this._tracker=o,this._app=e,this._cm=t,this._onActiveCellChanged(),this._tracker.activeCellChanged.connect(this._onActiveCellChanged,this)}_onActiveCellChanged(){const e=this._tracker.activeCell;if(null!==e){if(!s)return;const{commands:o}=this._app,t=e.editor;t.setOption("keyMap","vim");const n=t.getOption("extraKeys")||{};n.Esc=this._cm.prototype.leaveInsertMode,i||(n["Ctrl-C"]=!1),this._cm.prototype.save=()=>{o.execute("docmanager:save")},t.setOption("extraKeys",n);const d=this._cm.Vim;d.defineEx("quit","q",(e=>{o.execute("notebook:enter-command-mode")})),this._cm.Vim.handleKey(t.editor,"<Esc>");const l=(t,n,d,c)=>{const i=n;let a=i.ch;const s=e;switch(null==c?void 0:c.lastMotion){case t.moveByLines:case t.moveByDisplayLines:case t.moveByScroll:case t.moveToColumn:case t.moveToEol:case l:a=c.lastHPos;break;default:c.lastHPos=a}const r=d.repeat+(d.repeatOffset||0);let m=d.forward?i.line+r:i.line-r;const k=t.firstLine(),b=t.lastLine(),p=t.findPosV(i,d.forward?r:-r,"line",c.lastHSPos);return(d.forward?p.line>m:p.line<m)&&(m=p.line,a=p.ch),m<k||m>b?(null!==s&&"markdown"===s.model.type&&(s.rendered=!0),void(d.forward?o.execute("notebook:move-cursor-down"):o.execute("notebook:move-cursor-up"))):(d.toFirstChar&&(a=function(e){if(!e)return 0;const o=e.search(/\S/);return-1===o?e.length:o}(t.getLine(m)),c.lastHPos=a),c.lastHSPos=t.charCoords(this._cm.Pos(m,a),"div").left,this._cm.Pos(m,a))};d.defineMotion("moveByLinesOrCell",l),d.mapCommand("k","motion","moveByLinesOrCell",{forward:!1,linewise:!0},{context:"normal"}),d.mapCommand("j","motion","moveByLinesOrCell",{forward:!0,linewise:!0},{context:"normal"}),d.defineAction("moveCellDown",((e,t)=>{o.execute("notebook:move-cell-down")})),d.defineAction("moveCellUp",((e,t)=>{o.execute("notebook:move-cell-up")})),d.mapCommand("<C-e>","action","moveCellDown",{},{extra:"normal"}),d.mapCommand("<C-y>","action","moveCellUp",{},{extra:"normal"}),d.defineAction("splitCell",((e,t)=>{o.execute("notebook:split-cell-at-cursor")})),d.mapCommand("-","action","splitCell",{},{extra:"normal"})}}}const k=r}}]);