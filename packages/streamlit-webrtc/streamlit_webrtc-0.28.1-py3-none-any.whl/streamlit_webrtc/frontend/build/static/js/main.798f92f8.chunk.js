(this.webpackJsonpstreamlit_webrtc=this.webpackJsonpstreamlit_webrtc||[]).push([[0],{114:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),r=n(21),o=n.n(r),s=n(81),c=n(154),l=n(156),d=n(18),u=n(5),v=n.n(u),f=n(8),p=n(1),b=n(4),m=n(11),j=n(10),h=n(2),O=n(3),g=n(25),S=n(121),y=n(84),x=n(157),D=n(77),I=n(79),w=n.n(I),A=n(12),E=function(e){var t=e.theme,n=a.a.useMemo((function(){if(null!=t){var e=w.a.scale([t.textColor,t.backgroundColor]).mode("lab");return Object(s.a)({palette:{primary:{main:t.primaryColor},background:{default:t.backgroundColor,paper:t.secondaryBackgroundColor},text:{primary:t.textColor,secondary:e(.1).hex(),disabled:e(.5).hex()}},typography:{fontFamily:t.font}})}}),[t]);return null==n?Object(A.jsx)(A.Fragment,{children:e.children}):Object(A.jsx)(c.a,{theme:n,children:e.children})},C=n(15),N=function(e){Object(i.useEffect)((function(){g.a.setFrameHeight()}));var t=e.stream.getVideoTracks().length>0,n=Object(i.useCallback)((function(t){t&&(t.srcObject=e.stream)}),[e.stream]),a=Object(i.useCallback)((function(){return g.a.setFrameHeight()}),[]);if(t){var r,o,s,c,l,d,u,v,f,p,b,m,j,h,O,S,y={hidden:null===(r=e.userDefinedVideoAttrs)||void 0===r?void 0:r.hidden,style:null===(o=e.userDefinedVideoAttrs)||void 0===o?void 0:o.style,autoPlay:null===(s=e.userDefinedVideoAttrs)||void 0===s?void 0:s.autoPlay,controls:null===(c=e.userDefinedVideoAttrs)||void 0===c?void 0:c.controls,controlsList:null===(l=e.userDefinedVideoAttrs)||void 0===l?void 0:l.controlsList,crossOrigin:null===(d=e.userDefinedVideoAttrs)||void 0===d?void 0:d.crossOrigin,loop:null===(u=e.userDefinedVideoAttrs)||void 0===u?void 0:u.loop,mediaGroup:null===(v=e.userDefinedVideoAttrs)||void 0===v?void 0:v.mediaGroup,muted:null===(f=e.userDefinedVideoAttrs)||void 0===f?void 0:f.muted,playsInline:null===(p=e.userDefinedVideoAttrs)||void 0===p?void 0:p.playsInline,preload:null===(b=e.userDefinedVideoAttrs)||void 0===b?void 0:b.preload,height:null===(m=e.userDefinedVideoAttrs)||void 0===m?void 0:m.height,poster:null===(j=e.userDefinedVideoAttrs)||void 0===j?void 0:j.poster,width:null===(h=e.userDefinedVideoAttrs)||void 0===h?void 0:h.width,disablePictureInPicture:null===(O=e.userDefinedVideoAttrs)||void 0===O?void 0:O.disablePictureInPicture,disableRemotePlayback:null===(S=e.userDefinedVideoAttrs)||void 0===S?void 0:S.disableRemotePlayback};return Object(A.jsx)("video",Object(C.a)(Object(C.a)({},y),{},{ref:n,onCanPlay:a}))}var x,D,I,w,E,N,k,P,R,T,L,V={hidden:null===(x=e.userDefinedAudioAttrs)||void 0===x?void 0:x.hidden,style:null===(D=e.userDefinedAudioAttrs)||void 0===D?void 0:D.style,autoPlay:null===(I=e.userDefinedAudioAttrs)||void 0===I?void 0:I.autoPlay,controls:null===(w=e.userDefinedAudioAttrs)||void 0===w?void 0:w.controls,controlsList:null===(E=e.userDefinedAudioAttrs)||void 0===E?void 0:E.controlsList,crossOrigin:null===(N=e.userDefinedAudioAttrs)||void 0===N?void 0:N.crossOrigin,loop:null===(k=e.userDefinedAudioAttrs)||void 0===k?void 0:k.loop,mediaGroup:null===(P=e.userDefinedAudioAttrs)||void 0===P?void 0:P.mediaGroup,muted:null===(R=e.userDefinedAudioAttrs)||void 0===R?void 0:R.muted,playsInline:null===(T=e.userDefinedAudioAttrs)||void 0===T?void 0:T.playsInline,preload:null===(L=e.userDefinedAudioAttrs)||void 0===L?void 0:L.preload};return Object(A.jsx)("audio",Object(C.a)({ref:n},V))},k=a.a.memo(N),P=n(115),R=n(118),T=n(155),L=n(80),V=n.n(L),G=Object(P.a)((function(e){return{paper:{padding:e.spacing(4),display:"flex",justifyContent:"center",alignItems:"center",width:"100%"}}})),_=function(e){Object(i.useEffect)((function(){g.a.setFrameHeight()}));var t=G();return Object(A.jsx)(R.a,{className:t.paper,elevation:0,children:e.loading?Object(A.jsx)(T.a,{}):Object(A.jsx)(V.a,{fontSize:"large"})})},Y=a.a.memo(_);function M(e,t,n){var i=e||{};return t&&(!0===i.video?i.video={deviceId:t}:"object"!==typeof i.video&&null!=i.video||(i.video=Object(C.a)(Object(C.a)({},i.video),{},{deviceId:t}))),n&&(!0===i.audio?i.audio={deviceId:n}:"object"!==typeof i.audio&&null!=i.audio||(i.audio=Object(C.a)(Object(C.a)({},i.audio),{},{deviceId:n}))),i}function B(e){return g.a.setComponentValue(e)}var F=function(e){return"RECVONLY"===e||"SENDONLY"===e||"SENDRECV"===e},H=function(e){return e.createOffer().then((function(t){return console.log("Created offer:",t),e.setLocalDescription(t)})).then((function(){return console.log("Wait for ICE gethering..."),new Promise((function(t){if("complete"===e.iceGatheringState)t();else{e.addEventListener("icegatheringstatechange",(function n(){"complete"===e.iceGatheringState&&(e.removeEventListener("icegatheringstatechange",n),t())}))}}))})).then((function(){return e.localDescription})).catch((function(e){throw console.error(e),e}))},U=function(e){Object(h.a)(n,e);var t=Object(O.a)(n);function n(e){var i;return Object(p.a)(this,n),(i=t.call(this,e)).pc=void 0,i.signallingTimer=void 0,i.processAnswerInner=function(){var e=Object(f.a)(v.a.mark((function e(t,n){var i;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=JSON.parse(n),console.log("Receive answer sdpOffer",i),e.next=4,t.setRemoteDescription(i);case 4:console.log("Remote description is set");case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),i.processAnswer=function(e,t){i.processAnswerInner(e,t).then((function(){i.signallingTimer&&clearTimeout(i.signallingTimer),i.setState({webRtcState:"PLAYING",sdpOffer:null})})).catch((function(e){i.setState({error:e}),i.stop()}))},i.startInner=Object(f.a)(v.a.mark((function e(){var t,n,a,r,o,s,c,l,u;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.props.args.mode,F(t)){e.next=3;break}throw new Error("Invalid mode ".concat(t));case 3:if(i.setState({webRtcState:"SIGNALLING",stream:null,error:null}),n=i.props.args.rtc_configuration||{},console.log("RTCConfiguration:",n),a=new RTCPeerConnection(n),"SENDRECV"!==t&&"RECVONLY"!==t||a.addEventListener("track",(function(e){var t=e.streams[0];i.setState({stream:t})})),"SENDRECV"!==t&&"SENDONLY"!==t){e.next=23;break}if(s=M(i.props.args.media_stream_constraints,null===(r=i.state.videoInput)||void 0===r?void 0:r.deviceId,null===(o=i.state.audioInput)||void 0===o?void 0:o.deviceId),console.log("MediaStreamConstraints:",s),!s.audio&&!s.video){e.next=20;break}if(null!=navigator.mediaDevices){e.next=14;break}throw new Error("navigator.mediaDevices is undefined. It seems the current document is not loaded securely.");case 14:if(null!=navigator.mediaDevices.getUserMedia){e.next=16;break}throw new Error("getUserMedia is not implemented in this browser");case 16:return e.next=18,navigator.mediaDevices.getUserMedia(s);case 18:(c=e.sent).getTracks().forEach((function(e){a.addTrack(e,c)}));case 20:if("SENDONLY"===t){l=Object(d.a)(a.getTransceivers());try{for(l.s();!(u=l.n()).done;)u.value.direction="sendonly"}catch(v){l.e(v)}finally{l.f()}}e.next=24;break;case 23:"RECVONLY"===t&&(a.addTransceiver("video",{direction:"recvonly"}),a.addTransceiver("audio",{direction:"recvonly"}));case 24:return console.log("transceivers",a.getTransceivers()),i.pc=a,e.next=28,H(a).then((function(e){if(null==e)throw new Error("Failed to create an offer SDP");i.setState({sdpOffer:e})}));case 28:case"end":return e.stop()}}),e)}))),i.start=function(){"STOPPED"===i.state.webRtcState&&(i.setState({signallingTimedOut:!1}),i.signallingTimer=setTimeout((function(){i.setState({signallingTimedOut:!0})}),1e4),i.startInner().catch((function(e){return i.setState({webRtcState:"STOPPED",sdpOffer:null,error:e})})))},i.stopInner=Object(f.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("STOPPING"!==i.state.webRtcState){e.next=2;break}return e.abrupt("return");case 2:if(t=i.pc,i.pc=void 0,i.setState({webRtcState:"STOPPING",sdpOffer:null}),null!=t){e.next=7;break}return e.abrupt("return");case 7:return t.getTransceivers&&t.getTransceivers().forEach((function(e){e.stop&&e.stop()})),t.getSenders().forEach((function(e){var t;null===(t=e.track)||void 0===t||t.stop()})),e.abrupt("return",new Promise((function(e){setTimeout((function(){t.close(),e()}),500)})));case 10:case"end":return e.stop()}}),e)}))),i.stop=function(){i.stopInner().catch((function(e){return i.setState({error:e})})).finally((function(){i.setState({webRtcState:"STOPPED",sdpOffer:null,stream:null})}))},i.reconcilePlayingState=function(){var e=i.props.args.desired_playing_state;null!=e&&(!0===e&&"STOPPED"===i.state.webRtcState?i.start():!1!==e||"SIGNALLING"!==i.state.webRtcState&&"PLAYING"!==i.state.webRtcState||i.stop())},i.initializeComponentValue=function(){return B({playing:!1,sdpOffer:""})},i.reconcileComponentValue=function(e){if(i.state!==e){var t="PLAYING"===i.state.webRtcState,n=t!==("PLAYING"===e.webRtcState),a=i.state.sdpOffer,r=e.sdpOffer;(n||a!==r)&&(a&&console.log("Send SDP offer",a),B({playing:t,sdpOffer:a?a.toJSON():""}))}},i.handleDeviceSelect=function(e,t){i.setState({videoInput:e,audioInput:t})},i.render=function(){var e,t=i.props.args.desired_playing_state,n=i.props.disabled||"SIGNALLING"===i.state.webRtcState&&!i.state.signallingTimedOut||"STOPPING"===i.state.webRtcState||null!=t,a=i.props.args.mode,r={videoEnabled:!(e=i.props.args.media_stream_constraints)||!!e.video,audioEnabled:!e||!!e.audio},o=r.videoEnabled,s=r.audioEnabled,c=F(a)&&function(e){return"SENDRECV"===e||"RECVONLY"===e}(a),l=F(a)&&function(e){return"SENDRECV"===e||"SENDONLY"===e}(a);return Object(A.jsx)(E,{theme:i.props.theme,children:Object(A.jsxs)(S.a,{children:[i.state.error&&Object(A.jsxs)(x.a,{severity:"error",children:[i.state.error.name,": ",i.state.error.message]}),Object(A.jsx)(S.a,{py:1,display:"flex",children:i.state.stream?Object(A.jsx)(k,{stream:i.state.stream,userDefinedVideoAttrs:i.props.args.video_html_attrs,userDefinedAudioAttrs:i.props.args.audio_html_attrs}):c&&Object(A.jsx)(Y,{loading:"SIGNALLING"===i.state.webRtcState})}),Object(A.jsxs)(S.a,{display:"flex",justifyContent:"space-between",children:["PLAYING"===i.state.webRtcState||"SIGNALLING"===i.state.webRtcState?Object(A.jsx)(y.a,{variant:"contained",onClick:i.stop,disabled:n,children:"Stop"}):Object(A.jsx)(y.a,{variant:"contained",color:"primary",onClick:i.start,disabled:n,children:"Start"}),l&&Object(A.jsx)(D.a,{videoEnabled:o,audioEnabled:s,onSelect:i.handleDeviceSelect,value:{video:i.state.videoInput,audio:i.state.audioInput}})]})]})})},i.state={webRtcState:"STOPPED",sdpOffer:null,signallingTimedOut:!1,videoInput:null,audioInput:null,stream:null,error:null},i}return Object(b.a)(n,[{key:"componentDidMount",value:function(){Object(m.a)(Object(j.a)(n.prototype),"componentDidMount",this).call(this),this.initializeComponentValue(),this.reconcilePlayingState()}},{key:"componentDidUpdate",value:function(e,t){if(Object(m.a)(Object(j.a)(n.prototype),"componentDidUpdate",this).call(this),this.reconcilePlayingState(),this.reconcileComponentValue(t),null!=this.pc){var i=this.pc;if(null==i.remoteDescription){var a=this.props.args.sdp_answer_json;a!==e.args.sdp_answer_json&&a&&"SIGNALLING"===this.state.webRtcState&&this.processAnswer(i,a)}}}}]),n}(g.b),W=Object(g.c)(U),J=Object(s.a)({overrides:{MuiCssBaseline:{"@global":{body:{backgroundColor:"initial"}}}}});o.a.render(Object(A.jsx)(a.a.StrictMode,{children:Object(A.jsxs)(c.a,{theme:J,children:[Object(A.jsx)(l.a,{}),Object(A.jsx)(W,{})]})}),document.getElementById("root"))},77:function(e,t,n){"use strict";(function(e){var i=n(18),a=n(16),r=n(0),o=n.n(r),s=n(25),c=n(121),l=n(115),d=n(84),u=n(73),v=n(86),f=n(85),p=n(123),b=n(119),m=n(118),j=n(12),h=Object(l.a)((function(e){return{paper:{padding:e.spacing(2)},formControl:{maxWidth:"80vw",margin:e.spacing(1),minWidth:120,display:"flex"},formButtonControl:{margin:e.spacing(2),marginBottom:e.spacing(1),minWidth:120,display:"flex"},selectEmpty:{marginTop:e.spacing(2)}}})),O=function(t){var n=t.labelId,i=t.value,a=t.devices,o=t.onChange,s=h(),c=Object(r.useCallback)((function(e){var t=a.find((function(t){return t.deviceId===e.target.value}));o(t||null)}),[a,o]);return 0===a.length?Object(j.jsx)(f.a,{value:"",disabled:!0,children:Object(j.jsx)("option",{"aria-label":"None",value:""})}):null==i?(e((function(){return o(a[0])})),null):Object(j.jsx)(f.a,{labelId:n,value:i.deviceId,onChange:c,className:s.selectEmpty,children:a.map((function(e){return Object(j.jsx)(p.a,{value:e.deviceId,children:e.label},e.deviceId)}))})},g=function(e){var t=e.open,n=e.anchorEl,i=e.videoEnabled,o=e.audioEnabled,c=e.value,l=e.devicesMap,f=e.onSubmit,p=Object(r.useState)(null),g=Object(a.a)(p,2),S=g[0],y=g[1],x=Object(r.useState)(null),D=Object(a.a)(x,2),I=D[0],w=D[1];Object(r.useEffect)((function(){y(l.video.find((function(e){var t;return e.deviceId===(null===(t=c.video)||void 0===t?void 0:t.deviceId)}))||null),w(l.audio.find((function(e){var t;return e.deviceId===(null===(t=c.audio)||void 0===t?void 0:t.deviceId)}))||null)}),[l,c]);var A=Object(r.useCallback)((function(e){e.preventDefault(),f(i?S:null,o?I:null)}),[f,i,o,S,I]),E=h(),C=Object(r.useRef)(),N=Object(r.useCallback)((function(e){if(e)setTimeout((function(){var t=document.getElementsByTagName("body")[0];C.current=t.style.height;var n=window.getComputedStyle(e),i=new WebKitCSSMatrix(n.transform).m42+e.getBoundingClientRect().height;i>document.body.scrollHeight&&(t.style.height="".concat(i,"px"),s.a.setFrameHeight())}),0);else{var t=document.getElementsByTagName("body")[0];null!=C.current&&(t.style.height=C.current),s.a.setFrameHeight()}}),[]);return Object(j.jsx)(b.a,{ref:N,open:t,anchorEl:n,placement:"left-end",children:Object(j.jsx)(m.a,{className:E.paper,children:Object(j.jsxs)("form",{onSubmit:A,children:[i&&Object(j.jsxs)(u.a,{className:E.formControl,children:[Object(j.jsx)(v.a,{id:"video-input-select",children:"Video input"}),Object(j.jsx)(O,{labelId:"video-input-select",devices:l.video,value:S,onChange:y})]}),o&&Object(j.jsxs)(u.a,{className:E.formControl,children:[Object(j.jsx)(v.a,{id:"audio-input-select",children:"Audio input"}),Object(j.jsx)(O,{labelId:"audio-input-select",devices:l.audio,value:I,onChange:w})]}),Object(j.jsx)(u.a,{className:E.formButtonControl,children:Object(j.jsx)(d.a,{type:"submit",variant:"contained",color:"primary",children:"OK"})})]})})})},S=function(e){var t=e.videoEnabled,n=e.audioEnabled,s=e.value,l=e.onSelect,u=Object(r.useState)(!1),v=Object(a.a)(u,2),f=v[0],p=v[1],b=o.a.useState(null),m=Object(a.a)(b,2),h=m[0],O=m[1],S=Object(r.useState)(),y=Object(a.a)(S,2),x=y[0],D=y[1],I=Object(r.useState)(!1),w=Object(a.a)(I,2),A=w[0],E=w[1],C=Object(r.useCallback)((function(e){var t,n;if(O(e.currentTarget),"function"!==typeof(null===(t=navigator)||void 0===t||null===(n=t.mediaDevices)||void 0===n?void 0:n.enumerateDevices))return D(void 0),void E(!0);navigator.mediaDevices.enumerateDevices().then((function(e){var t,n=[],a=[],r=Object(i.a)(e);try{for(r.s();!(t=r.n()).done;){var o=t.value;"videoinput"===o.kind?n.push(o):"audioinput"===o.kind&&a.push(o)}}catch(s){r.e(s)}finally{r.f()}D({video:n,audio:a}),p(!0)}))}),[]),N=Object(r.useCallback)((function(){return p(!1)}),[]),k=Object(r.useCallback)((function(e,t){D(void 0),p(!1),l(e,t)}),[l]);return Object(j.jsxs)(c.a,{children:[A&&Object(j.jsx)("p",{children:"Unavailable"}),x&&Object(j.jsx)(g,{open:f,anchorEl:h,videoEnabled:t,audioEnabled:n,value:s,devicesMap:x,onSubmit:k}),Object(j.jsx)(d.a,{onClick:f?N:C,children:"Select device"})]})};t.a=o.a.memo(S)}).call(this,n(103).setImmediate)}},[[114,1,2]]]);
//# sourceMappingURL=main.798f92f8.chunk.js.map