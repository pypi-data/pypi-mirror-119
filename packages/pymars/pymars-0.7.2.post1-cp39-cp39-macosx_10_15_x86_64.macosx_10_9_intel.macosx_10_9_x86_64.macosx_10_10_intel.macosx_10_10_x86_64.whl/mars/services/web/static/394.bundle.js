(self.webpackChunkmars_ui=self.webpackChunkmars_ui||[]).push([[394],{394:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>F});var r=n(7294),o=n(5697),l=n.n(o),i=n(5977),a=n(1749),s=n(9895),c=n(5517),u=n(5713),f=n(4017),p=n(5095),d=n(4949);function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(a,e);var t,n,o,l,i=(o=a,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=m(o);if(l){var n=m(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return g(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e)).state={selectedTileable:null,tileables:[],dependencies:[],tileableDetails:{},tileableStatus:[{text:"Pending",color:"#FFFFFF",legendDotXLoc:"430",legendDotYLoc:"20",legendTextXLoc:"440",legendTextYLoc:"21"},{text:"Running",color:"#F4B400",legendDotXLoc:"10",legendDotYLoc:"20",legendTextXLoc:"20",legendTextYLoc:"21"},{text:"Succeeded",color:"#00CD95",legendDotXLoc:"105",legendDotYLoc:"20",legendTextXLoc:"115",legendTextYLoc:"21"},{text:"Failed",color:"#E74C3C",legendDotXLoc:"345",legendDotYLoc:"20",legendTextXLoc:"355",legendTextYLoc:"21"},{text:"Cancelled",color:"#BFC9CA",legendDotXLoc:"225",legendDotYLoc:"20",legendTextXLoc:"235",legendTextYLoc:"21"}]},t}return t=a,(n=[{key:"fetchGraphDetail",value:function(){var e=this,t=this.props,n=t.sessionId,r=t.taskId;fetch("api/session/".concat(n,"/task/").concat(r,"/tileable_graph?action=get_tileable_graph_as_json")).then((function(e){return e.json()})).then((function(t){e.setState({tileables:t.tileables,dependencies:t.dependencies})}))}},{key:"fetchTileableDetail",value:function(){var e=this,t=this.props,n=t.sessionId,r=t.taskId;fetch("api/session/".concat(n,"/task/").concat(r,"/tileable_detail")).then((function(e){return e.json()})).then((function(t){e.setState({tileableDetails:t})}))}},{key:"componentDidMount",value:function(){var e=this;this.g=(new d.graphlib.Graph).setGraph({}),void 0!==this.interval&&clearInterval(this.interval),this.interval=setInterval((function(){return e.fetchTileableDetail()}),5e3),this.fetchTileableDetail(),this.fetchGraphDetail()}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"generateGraphLegendItem",value:function(e,t,n,r,o,l,i){"#FFFFFF"===l?e.append("circle").attr("cx",t).attr("cy",n).attr("r",6).attr("stroke","#333").style("fill",l):e.append("circle").attr("cx",t).attr("cy",n).attr("r",6).style("fill",l),e.append("text").attr("x",r).attr("y",o).text(i).style("font-size","15px").attr("alignment-baseline","middle")}},{key:"componentDidUpdate",value:function(e,t,n){var r=this;if(Object.keys(this.state.tileableDetails).length===this.state.tileables.length){if(t.tileables!==this.state.tileables&&t.dependencies!==this.state.dependencies){(0,f.Z)("#svg-canvas").selectAll("*").remove();var o=(0,f.Z)("#svg-canvas"),l=o.append("g");this.g=(new d.graphlib.Graph).setGraph({});var i=(0,f.Z)("#legend");this.state.tileableStatus.forEach((function(e){return r.generateGraphLegendItem(i,e.legendDotXLoc,e.legendDotYLoc,e.legendTextXLoc,e.legendTextYLoc,e.color,e.text)})),this.state.tileables.forEach((function(e){var t={tileable:e},n=r.state.tileableDetails[e.tileableId],o=e.tileableName.indexOf("key")-1;t.label=e.tileableName.substring(0,o),t.rx=t.ry=5,r.g.setNode(e.tileableId,t);var i=l.append("linearGradient").attr("id","progress-"+e.tileableId);i.append("stop").attr("id","progress-"+e.tileableId+"-stop").attr("stop-color",r.state.tileableStatus[n.status].color).attr("offset",n.progress),i.append("stop").attr("stop-color","#FFFFFF").attr("offset","0");var a=r.g.node(e.tileableId);a.style="cursor: pointer; stroke: #333; fill: url(#progress-"+e.tileableId+")",a.labelStyle="cursor: pointer"})),this.state.dependencies.forEach((function(e){1===e.linkType?r.g.setEdge(e.fromTileableId,e.toTileableId,{style:"stroke: #333; fill: none; stroke-dasharray: 5, 5;"}):r.g.setEdge(e.fromTileableId,e.toTileableId,{style:"stroke: #333; fill: none;"})}));var a=this.g;a.nodes().forEach((function(e){var t=a.node(e);t.rx=t.ry=5}));var s=new d.render;0!==this.state.tileables.length&&s(l,this.g),l.selectAll("g.node").on("click",(function(e,t){if(r.props.onTileableClick){var n=r.state.tileables.filter((function(e){return e.tileableId==t}))[0];r.props.onTileableClick(e,n)}}));var c=l.node().getBBox(),u=l.node().parentElement,h=c.width,b=c.height,y=u.clientWidth,g=u.clientHeight,m=g>=b?1:g/b;(0,f.Z)(".output").attr("transform","translate("+(y-h*m)/2+", "+(g-b*m)/2+")");var v=(0,p.sP)().on("zoom",(function(e){l.attr("transform",e.transform)}));o.call(v,v.transform,p.CR.scale(m)),null!==this.g.graph()||void 0!==this.g.graph()?o.attr("height",this.g.graph().height*m+40):o.attr("height",40)}if(t.tileables===this.state.tileables&&t.dependencies===this.state.dependencies&&t.tileableDetails!==this.state.tileableDetails){var k=(0,f.Z)("#svg-canvas");this.state.tileables.forEach((function(e){var t=r.state.tileableDetails[e.tileableId];k.select("#progress-"+e.tileableId+"-stop").attr("stop-color",r.state.tileableStatus[t.status].color).attr("offset",t.progress)}))}}}},{key:"render",value:function(){return r.createElement(r.Fragment,null,r.createElement("svg",{id:"legend",style:{marginLeft:"6%",width:"90%",height:"10%"}}),r.createElement("svg",{id:"svg-canvas",style:{margin:30,width:"90%",height:"80%"}}))}}])&&b(t.prototype,n),a}(r.Component);function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function T(e,t){return!t||"object"!==k(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}v.propTypes={sessionId:l().string.isRequired,taskId:l().string.isRequired,onTileableClick:l().func};var O=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&x(e,t)}(a,e);var t,n,o,l,i=(o=a,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=_(o);if(l){var n=_(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return T(this,e)});function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e)).state={},t}return t=a,(n=[{key:"render",value:function(){return void 0===this.props?null:this.props.tileable?r.createElement("div",null,r.createElement("div",null,"Tileable ID: ",r.createElement("br",null),this.props.tileable.tileableId),r.createElement("br",null),r.createElement("div",null,"Tileable Name: ",r.createElement("br",null),this.props.tileable.tileableName),r.createElement("br",null)):r.createElement("div",null,"Select a tileable to view its detail")}}])&&E(t.prototype,n),a}(r.Component);O.propTypes={tileable:l().shape({tileableId:l().string,tileableName:l().string}),sessionId:l().string.isRequired,taskId:l().string.isRequired};const I=O;function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function L(e,t){return!t||"object"!==w(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var j=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(f,e);var t,n,o,l,i=(o=f,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=R(o);if(l){var n=R(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return L(this,e)});function f(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(t=i.call(this,e)).state={selectedTileable:null},t}return t=f,(n=[{key:"render",value:function(){var e=this;return void 0===this.props?null:r.createElement(a.Z,{container:!0,spacing:3},r.createElement(a.Z,{item:!0,xs:12},r.createElement(u.Z,null,"Task ",this.props.match.params.task_id)),r.createElement(a.Z,{item:!0,xs:12},r.createElement(s.Z,null,r.createElement(a.Z,{container:!0,spacing:3},r.createElement(a.Z,{item:!0,xs:12,sm:6},r.createElement(v,{sessionId:this.props.match.params.session_id,taskId:this.props.match.params.task_id,onTileableClick:function(t,n){e.setState({selectedTileable:n})}})),r.createElement(c.Z,{orientation:"vertical",flexItem:!0,style:{marginRight:"-1px"}}),r.createElement(a.Z,{item:!0,xs:12,sm:6},r.createElement(a.Z,{item:!0,xs:12},r.createElement(I,{tileable:this.state.selectedTileable,sessionId:this.props.match.params.session_id,taskId:this.props.match.params.task_id})))))))}}])&&D(t.prototype,n),f}(r.Component);j.propTypes={match:l().shape({params:l().shape({session_id:l().string.isRequired,task_id:l().string.isRequired})})};const F=(0,i.EN)(j)}}]);